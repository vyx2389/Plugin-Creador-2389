<?php

/**
 * @author Jasman
 * @copyright Ihsana IT Solution 2015
 * @package WordPress Plugin Maker
 * @license Commercial License
 */

defined("EXEC") or die();

/**
 * This variabel must be according wordpress API
 * this deps for javascripts  
 **/
 
$deps[] = array("label" => "jQuery", "value" => "jquery");
$deps[] = array("label" => "Jcrop", "value" => "jcrop");
$deps[] = array("label" => "SWFObject", "value" => "swfobject");
$deps[] = array("label" => "SWFUpload", "value" => "swfupload");
$deps[] = array("label" => "SWFUpload Degrade", "value" => "swfupload-degrade");
$deps[] = array("label" => "SWFUpload Queue", "value" => "swfupload-queue");
$deps[] = array("label" => "SWFUpload Handlers", "value" => "swfupload-handlers");
$deps[] = array("label" => "jQuery Form", "value" => "jquery-form");
$deps[] = array("label" => "jQuery Color", "value" => "jquery-color");
$deps[] = array("label" => "jQuery Masonry", "value" => "jquery-masonry");
$deps[] = array("label" => "Masonry (native Javascript)", "value" => "masonry");
$deps[] = array("label" => "jQuery UI Core", "value" => "jquery-ui-core");
$deps[] = array("label" => "jQuery UI Widget", "value" => "jquery-ui-widget");
$deps[] = array("label" => "jQuery UI Accordion", "value" => "jquery-ui-accordion");
$deps[] = array("label" => "jQuery UI Autocomplete", "value" => "jquery-ui-autocomplete");
$deps[] = array("label" => "jQuery UI Button", "value" => "jquery-ui-button");
$deps[] = array("label" => "jQuery UI Datepicker", "value" => "jquery-ui-datepicker");
$deps[] = array("label" => "jQuery UI Dialog", "value" => "jquery-ui-dialog");
$deps[] = array("label" => "jQuery UI Draggable", "value" => "jquery-ui-draggable");
$deps[] = array("label" => "jQuery UI Droppable", "value" => "jquery-ui-droppable");
$deps[] = array("label" => "jQuery UI Menu", "value" => "jquery-ui-menu");
$deps[] = array("label" => "jQuery UI Mouse", "value" => "jquery-ui-mouse");
$deps[] = array("label" => "jQuery UI Position", "value" => "jquery-ui-position");
$deps[] = array("label" => "jQuery UI Progressbar", "value" => "jquery-ui-progressbar");
$deps[] = array("label" => "jQuery UI Selectable", "value" => "jquery-ui-selectable");
$deps[] = array("label" => "jQuery UI Resizable", "value" => "jquery-ui-resizable");
$deps[] = array("label" => "jQuery UI Selectmenu", "value" => "jquery-ui-selectmenu");
$deps[] = array("label" => "jQuery UI Sortable", "value" => "jquery-ui-sortable");
$deps[] = array("label" => "jQuery UI Slider", "value" => "jquery-ui-slider");
$deps[] = array("label" => "jQuery UI Tooltips", "value" => "jquery-ui-tooltip");
$deps[] = array("label" => "jQuery UI Tabs", "value" => "jquery-ui-tabs");
$deps[] = array("label" => "jQuery UI Effects", "value" => "jquery-effects-core");
$deps[] = array("label" => "jQuery UI Effects - Blind", "value" => "jquery-effects-blind");
$deps[] = array("label" => "jQuery UI Effects - Bounce", "value" => "jquery-effects-bounce");
$deps[] = array("label" => "jQuery UI Effects - Clip", "value" => "jquery-effects-clip");
$deps[] = array("label" => "jQuery UI Effects - Drop", "value" => "jquery-effects-drop");
$deps[] = array("label" => "jQuery UI Effects - Explode", "value" => "jquery-effects-explode");
$deps[] = array("label" => "jQuery UI Effects - Fade", "value" => "jquery-effects-fade");
$deps[] = array("label" => "jQuery UI Effects - Fold", "value" => "jquery-effects-fold");
$deps[] = array("label" => "jQuery UI Effects - Highlight", "value" => "jquery-effects-highlight");
$deps[] = array("label" => "jQuery UI Effects - Pulsate", "value" => "jquery-effects-pulsate");
$deps[] = array("label" => "jQuery UI Effects - Scale", "value" => "jquery-effects-scale");
$deps[] = array("label" => "jQuery UI Effects - Shake", "value" => "jquery-effects-shake");
$deps[] = array("label" => "jQuery UI Effects - Slide", "value" => "jquery-effects-slide");
$deps[] = array("label" => "jQuery UI Effects - Transfer", "value" => "jquery-effects-transfer");
$deps[] = array("label" => "MediaElement.js (WP 3.6+)", "value" => "wp-mediaelement");
$deps[] = array("label" => "jQuery Schedule", "value" => "schedule");
$deps[] = array("label" => "jQuery Suggest", "value" => "suggest");
$deps[] = array("label" => "ThickBox", "value" => "thickbox");
$deps[] = array("label" => "jQuery HoverIntent", "value" => "hoverIntent");
$deps[] = array("label" => "jQuery Hotkeys", "value" => "jquery-hotkeys");
$deps[] = array("label" => "Simple AJAX Code-Kit", "value" => "sack");
$deps[] = array("label" => "QuickTags", "value" => "quicktags");
$deps[] = array("label" => "Iris (Colour picker)", "value" => "iris");
$deps[] = array("label" => "Farbtastic (deprecated)", "value" => "farbtastic");
$deps[] = array("label" => "ColorPicker (deprecated)", "value" => "colorpicker");
$deps[] = array("label" => "Tiny MCE", "value" => "tiny_mce");
$deps[] = array("label" => "Autosave", "value" => "autosave");
$deps[] = array("label" => "WordPress AJAX Response", "value" => "wp-ajax-response");
$deps[] = array("label" => "List Manipulation", "value" => "wp-lists");
$deps[] = array("label" => "WP Common", "value" => "common");
$deps[] = array("label" => "WP Editor", "value" => "editorremov");
$deps[] = array("label" => "WP Editor Functions", "value" => "editor-functions");
$deps[] = array("label" => "AJAX Cat", "value" => "ajaxcat");
$deps[] = array("label" => "Admin Categories", "value" => "admin-categories");
$deps[] = array("label" => "Admin Tags", "value" => "admin-tags");
$deps[] = array("label" => "Admin custom fields", "value" => "admin-custom-fields");
$deps[] = array("label" => "Password Strength Meter", "value" => "password-strength-meter");
$deps[] = array("label" => "Admin Comments", "value" => "admin-comments");
$deps[] = array("label" => "Admin Users", "value" => "admin-users");
$deps[] = array("label" => "Admin Forms", "value" => "admin-forms");
$deps[] = array("label" => "XFN", "value" => "xfn");
$deps[] = array("label" => "Upload", "value" => "upload");
$deps[] = array("label" => "PostBox", "value" => "postbox");
$deps[] = array("label" => "Slug", "value" => "slug");
$deps[] = array("label" => "Post", "value" => "post");
$deps[] = array("label" => "Page", "value" => "page");
$deps[] = array("label" => "Link", "value" => "link");
$deps[] = array("label" => "Comment", "value" => "comment");
$deps[] = array("label" => "Threaded Comments", "value" => "comment-reply");
$deps[] = array("label" => "Admin Gallery", "value" => "admin-gallery");
$deps[] = array("label" => "Media Upload", "value" => "media-upload");
$deps[] = array("label" => "Admin widgets", "value" => "admin-widgets");
$deps[] = array("label" => "Word Count", "value" => "word-count");
$deps[] = array("label" => "Theme Preview", "value" => "theme-preview");
$deps[] = array("label" => "JSON for JS", "value" => "json2");
$deps[] = array("label" => "Plupload Core", "value" => "plupload");
$deps[] = array("label" => "Plupload All Runtimes", "value" => "plupload-all");
$deps[] = array("label" => "Plupload HTML4", "value" => "plupload-html4");
$deps[] = array("label" => "Plupload HTML5", "value" => "plupload-html5");
$deps[] = array("label" => "Plupload Flash", "value" => "plupload-flash");
$deps[] = array("label" => "Plupload Silverlight", "value" => "plupload-silverlight");
$deps[] = array("label" => "Underscore js", "value" => "underscore");
$deps[] = array("label" => "Backbone js", "value" => "backbone");


//detect current project
if ($_SESSION['current_project'] != null)
{

    $current_set = null;
    $current_properties = json_decode(file_get_contents(PROJECT_PATH . '/' . $_SESSION['current_project'] . '.project.json'), true);
    if (!isset($_GET['act']))
    {
        $_GET['act'] = null;
    }

    if (!isset($_GET['max-javascript']))
    {
        $_GET['max-javascript'] = 1;
    }

    if ($_GET['max-javascript'] == 0)
    {
        $_GET['max-javascript'] = 1;
    }

    if (isset($_POST['save']))
    { //check if project locked
        if ($current_properties['lock'] == 'true')
        {
            header('Location: ./?page=project&err=locked_project');
            exit(0);
        }
        $links = $_POST['javascripts'];
        file_put_contents(PROJECT_PATH . '/' . $_SESSION['current_project'] . '.javascript.json', json_encode($links));
        rebuild();
        header('Location: ./?page=javascript&max-javascript=' . (int)$_GET['max-javascript']);
    }
    if ($_GET['act'] == 'reset')
    {
        @unlink(PROJECT_PATH . '/' . $_SESSION['current_project'] . '.javascript.json');
        header('Location: ./?page=javascript&max-javascript=' . (int)$_GET['max-javascript']);
    }
    $_content = null;
    $_content .= '<form action="" method="post" enctype="multipart/form-data" >';
    $_content .= '<div class="row">';

    if (file_exists(PROJECT_PATH . '/' . $_SESSION['current_project'] . '.javascript.json'))
    {
        $current_javascripts = json_decode(file_get_contents(PROJECT_PATH . '/' . $_SESSION['current_project'] . '.javascript.json'), true);
        $current_set = '<span class="badge">' . count($current_javascripts) . '</span>';
        if (count($current_javascripts) != $_GET['max-javascript'])
        {
            if ($_GET['act'] != 'max-javascript')
            {
                header('Location: ./?page=javascript&max-javascript=' . count($current_javascripts));
            }

        }
    }

    for ($i = 1; $i <= (int)$_GET['max-javascript']; $i++)
    {
        $x = $i - 1;
        $javascript['name'] = '';
        $javascript['src'] = '';
        $javascript['admin'] = false;
        $javascript['version'] = '';

        if (isset($current_javascripts[$x]))
        {
            if (isset($current_javascripts[$x]['name']))
            {
                $javascript['name'] = $current_javascripts[$x]['name'];
            }

            if (isset($current_javascripts[$x]['src']))
            {
                $javascript['src'] = $current_javascripts[$x]['src'];
            }
            if (isset($current_javascripts[$x]['version']))
            {
                $javascript['version'] = $current_javascripts[$x]['version'];
            } else
            {
                $javascript['version'] = '';
            }

            if (isset($current_javascripts[$x]['admin']))
            {
                if ($current_javascripts[$x]['admin'] == true)
                {
                    $javascript['admin'] = true;
                }
            } else
            {
                $javascript['admin'] = false;
            }

            if (isset($current_javascripts[$x]['deps']))
            {
                $javascript['deps'] = $current_javascripts[$x]['deps'];
            } else
            {
                $javascript['deps'] = null;
            }

            if (isset($current_javascripts[$x]['hooks']))
            {
                $javascript['hooks'] = $current_javascripts[$x]['hooks'];
            } else
            {
                $javascript['hooks'] = array();
            }

        }

        $_content .= '<div class="col-md-12" id="box-' . $x . '">';
        $_content .= '<div class="panel panel-default">';
        $_content .= '<div class="panel-heading"><h4 class="panel-title"><i class="fa fa-jsfiddle"></i> Javascript (' . $i . ') <a class="remove btn btn-default btn-xs pull-right" href="#box-' . $x . '"><span class="fa fa-trash"></span> ' . $javascript['name'] . '</a></h4></div>';
        $_content .= '<div class="panel-body">';
        $_content .= '<div class="form-group"><label>Name</label><input data-type="var" class="form-control" type="text" name="javascripts[' . $x . '][name]" value="' . $javascript['name'] . '" required="required" placeholder="bootstrap" /></div>';
        $_content .= '<div class="form-group"><label>Source</label><input class="form-control" type="text" name="javascripts[' . $x . '][src]" value="' . $javascript['src'] . '" required="required" placeholder="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"/></div>';
        $_content .= '<div class="form-group"><label>Version</label><input class="form-control" type="number" name="javascripts[' . $x . '][version]" value="' . $javascript['version'] . '"  placeholder="3.3.5" /></div>';
        $_content .= '<div class="form-group"><label>Interface</label>';
        $_content .= '<div class="checkbox">';
        if ($javascript['admin'] == true)
        {
            $_content .= '<label><input type="checkbox" checked="checked" name="javascripts[' . $x . '][admin]" value="1"/>Admin Area</label>';
        } else
        {
            $_content .= '<label><input type="checkbox" name="javascripts[' . $x . '][admin]" value="1"/>Admin Area</label>';
        }
        $_content .= '</div>';
        $_content .= '</div>';

        $_content .= '<div class="form-group">';
        $_content .= '<label>Hooks (Limit page)</label>';
        $_content .= '<div class="row">';
        for ($z = 0; $z < 6; $z++)
        {
            if (!isset($javascript['hooks'][$z]))
            {
                $javascript['hooks'][$z] = '';
            }
            $_content .= '
            <div class="col-md-4">
                <div class="form-group">
                    <input class="form-control input-sm" type="text" name="javascripts[' . $x . '][hooks][' . $z . ']" value="' . $javascript['hooks'][$z] . '" placeholder="fill blank if no need"  />
                </div>
            </div>';

        }
        $_content .= '</div>';
        $_content .= '</div>';

        $_content .= '<div class="form-group">';
        $_content .= '<label>The scripts that must be loaded before this script</label>';
        $_content .= '<p><a data-toggle="collapse" data-parent="#accordion" href="#deps-' . $x . '">+ Deps</a></p>';

        $_content .= '</div>';
        $_content .= '<div id="deps-' . $x . '" class="panel-collapse collapse">';
        $z = 0;
        foreach ($deps as $dep)
        {
            $_content .= '<div  class="col-md-4">';
            $_content .= '<div class="checkbox">';

            if (!isset($javascript['deps']))
            {
                $javascript['deps'] = array();
            }

            if (!is_array($javascript['deps']))
            {
                $javascript['deps'] = array();
            }

            if (in_array(trim($dep['value']), $javascript['deps']))
            {
                $_content .= '<label><input type="checkbox" checked="checked" name="javascripts[' . $x . '][deps][' . $z . ']" value="' . $dep['value'] . '"/>' . $dep['label'] . '</label>';
            } else
            {
                $_content .= '<label><input type="checkbox" name="javascripts[' . $x . '][deps][' . $z . ']" value="' . $dep['value'] . '"/>' . $dep['label'] . '</label>';
            }

            $_content .= '</div>';
            $_content .= '</div>';

            $z++;
        }
        $_content .= '</div>';


        $_content .= '</div>';
        $_content .= '</div>';
        $_content .= '</div>';
    }


    $_content .= '</div>';
    $_content .= '<button type="submit" class="btn btn-primary" name="save">Save</button> ';
    $_content .= 'or <a href="./?page=javascript&act=reset">Remove</a> ';
    $_content .= '</form>';

    $content = null;
    $content .= '<a href="#help-box" data-toggle="collapse" class="label label-danger pull-right" ><span class="fa fa-question"></span></a>';
    $content .= '<h2><span class="fa-stack fa-lg"><i class="fa fa-square-o fa-stack-2x"></i><i class="fa fa-jsfiddle fa-stack-1x"></i></span> External <strong>Javascripts</strong> ' . $current_set . '</h2>';
    $content .= '<div id="help-box" class="panel-collapse collapse">';
    $content .= '<blockquote><p>Allows plugins to queue <strong>scripts</strong> for the front end and back end</p></blockquote>';
    $content .= '</div>';

    $content .= '<div class="row">';
    $content .= '<div class="col-md-6">';
    $content .= '<div class="panel panel-default">';
    $content .= '<div class="panel-body">';
    $content .= max_select('javascript');
    $content .= '</div>';
    $content .= '</div>';
    $content .= '</div>';
    $content .= '</div>';

    $content .= $_content;


    define('JZ_CONTENT', $content);
    unset($content);
} else
{
    header('Location: ./?page=project&err=current_project');
}

?>